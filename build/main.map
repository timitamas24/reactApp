{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/auth/index.js","webpack:///./src/auth/router.js","webpack:///./src/auth/store.js","webpack:///./src/contract/index.js","webpack:///./src/contract/router.js","webpack:///./src/contract/store.js","webpack:///./src/index.js","webpack:///./src/utils/constants.js","webpack:///./src/utils/index.js","webpack:///./src/utils/middlewares.js","webpack:///./src/utils/wss.js","webpack:///external \"@koa/cors\"","webpack:///external \"http\"","webpack:///external \"jsonwebtoken\"","webpack:///external \"koa\"","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-jwt\"","webpack:///external \"koa-router\"","webpack:///external \"nedb-promise\"","webpack:///external \"ws\""],"names":["router","Router","createToken","user","jwt","sign","username","_id","jwtConfig","secret","expiresIn","createUser","response","console","log","userStore","insert","body","token","status","e","issue","error","message","post","ctx","request","credentials","findOne","password","UserStore","constructor","filename","autoload","store","dataStore","props","get","userId","state","ContractStore","find","tasks","splice","params","page","task","id","createContract","contract","broadcast","type","payload","put","contractId","createTask","updatedCount","update","del","remove","team","Error","salary","dateFrom","dateTo","app","Koa","server","http","createServer","callback","wss","WebSocket","Server","initWss","use","cors","timingLogger","exceptionHandler","bodyParser","prefix","publicApiRouter","authRouter","routes","allowedMethods","protectedApiRouter","taskRouter","listen","next","err","start","Date","now","method","url","value","on","ws","JSON","parse","close","verify","data","clients","forEach","client","readyState","OPEN","send","stringify"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","export * from './router';","import Router from 'koa-router';\r\nimport userStore from './store';\r\nimport jwt from 'jsonwebtoken';\r\nimport {jwtConfig} from '../utils';\r\n\r\nexport const router = new Router();\r\n\r\nconst createToken = (user) => {\r\n    return jwt.sign({ username: user.username, _id: user._id }, jwtConfig.secret, { expiresIn: 60 * 60 * 60 });\r\n};\r\n\r\nconst createUser = async (user, response) => {\r\n    try {\r\n        console.log(user);\r\n        await userStore.insert(user);\r\n        response.body = { token: createToken(user) };\r\n        response.status = 201;\r\n    } catch (e) {\r\n        response.body = { issue: [{ error: e.message }] };\r\n        response.status = 400;\r\n    }\r\n};\r\n\r\nrouter.post('/register', async (ctx) => await createUser(ctx.request.body, ctx.response));\r\n\r\nrouter.post('/login', async (ctx) => {\r\n    console.log('1');\r\n    const credentials = ctx.request.body;\r\n    console.log('2');\r\n    const response = ctx.response;\r\n    console.log('myUser: ', credentials, '  the user: ');\r\n    const user = await userStore.findOne({ username: credentials.username });\r\n    console.log('myUser: ', credentials, '  the user: ', user);\r\n    if (user && credentials.password === user.password) {\r\n        response.body = { token: createToken(user) };\r\n        response.status = 201;\r\n    } else {\r\n        response.body = { issue: [{ error: 'Invalid credentials' }] };\r\n        response.status = 400;\r\n    }\r\n});","import dataStore from 'nedb-promise';\r\n\r\nexport class UserStore {\r\n    constructor({ filename, autoload }) {\r\n        this.store = dataStore({ filename, autoload });\r\n    }\r\n\r\n    async findOne(props) {\r\n        return this.store.findOne(props);\r\n    }\r\n\r\n    async insert(user) {\r\n        return this.store.insert(user);\r\n    };\r\n}\r\n\r\nexport default new UserStore({ filename: './db/users.json', autoload: true });","export * from './router';","import Router from 'koa-router';\r\nimport ContractStore from './store';\r\nimport { broadcast } from '../utils';\r\n\r\nexport const router = new Router();\r\n\r\nrouter.get('/', async (ctx) => {\r\n    const response = ctx.response;\r\n    const userId = ctx.state.user._id;\r\n    response.body = await ContractStore.find({ userId });\r\n    response.status = 200;\r\n})\r\n\r\nrouter.get('/:page', async (ctx) => {\r\n    const response = ctx.response;\r\n    const userId = ctx.state.user._id;\r\n    const tasks = await ContractStore.find({ userId });\r\n    response.body = tasks.splice(ctx.params.page*5, ctx.params.page*5+5);\r\n    response.status = 200;\r\n})\r\n\r\nrouter.get('/:id', async (ctx) => {\r\n    const userId = ctx.state.user._id;\r\n    const task = await ContractStore.findOne({ _id: ctx.params.id });\r\n    const response = ctx.response;\r\n    if (task) {\r\n        if (task.userId === userId) {\r\n            response.body = task;\r\n            response.status = 200;\r\n        } else {\r\n            response.status = 403;\r\n        }\r\n    } else {\r\n        response.status = 404;\r\n    }\r\n});\r\n\r\nconst createContract = async (ctx, contract, response) => {\r\n    try {\r\n        const userId = ctx.state.user._id;\r\n        contract.userId = userId;\r\n        console.log('ma');\r\n        response.body = await ContractStore.insert(contract);\r\n        console.log('am');\r\n        response.status = 201;\r\n        console.log('created and works');\r\n        broadcast(userId, { type: 'created', payload: contract });\r\n    } catch (e) {\r\n        response.body = { message: e.message };\r\n        response.status = 400;\r\n    }\r\n};\r\n\r\nrouter.post('/', async ctx => await createContract(ctx, ctx.request.body, ctx.response));\r\n\r\nrouter.put('/:id', async (ctx) => {\r\n    const contract = ctx.request.body;\r\n    const id = ctx.params.id;\r\n    const contractId = contract._id;\r\n    const response = ctx.response;\r\n    if (contractId && contractId !== id) {\r\n        response.body = { message: 'Parameter id and body _id should be the same' };\r\n        response.status = 400;\r\n        return;\r\n    }\r\n    if (!contractId) {\r\n        console.log(\"test\");\r\n        await createTask(ctx, contract, response);\r\n    } else {\r\n        const userId = ctx.state.user._id;\r\n        contract.userId = userId;\r\n        const updatedCount = await ContractStore.update({ _id: id }, contract);\r\n        if (updatedCount === 1) {\r\n            response.body = contract;\r\n            response.status = 200;\r\n            broadcast(userId, { type: 'updated', payload: contract });\r\n        } else {\r\n            response.body = { message: 'Resource no longer exists' };\r\n            response.status = 405;\r\n        }\r\n    }\r\n});\r\n\r\nrouter.del('/:id', async (ctx) => {\r\n    const userId = ctx.state.user._id;\r\n    const contract = await ContractStore.findOne({ _id: ctx.params.id });\r\n    if (contract && userId !== contract.userId) {\r\n        ctx.response.status = 403;\r\n    } else {\r\n        await ContractStore.remove({ _id: ctx.params.id });\r\n        ctx.response.status = 204;\r\n    }\r\n});","import dataStore from \"nedb-promise\";\r\n\r\nexport class ContractStore {\r\n    constructor({ filename, autoload }) {\r\n        this.store = dataStore({ filename, autoload });\r\n    }\r\n\r\n    async find(props) {\r\n        return this.store.find(props);\r\n    }\r\n\r\n    async findOne(props) {\r\n        return this.store.findOne(props);\r\n    }\r\n\r\n    async insert(contract) {\r\n        if (!contract.team) {\r\n            throw new Error('Missing contract team');\r\n        }\r\n        if (!contract.salary) {\r\n            throw new Error('Missing contract salary');\r\n        }\r\n        if (!contract.dateFrom) {\r\n            throw new Error('Missing contract start date');\r\n        }\r\n        if (!contract.dateTo) {\r\n            throw new Error('Missing contract stop date');\r\n        }\r\n        console.log('store.insert passed');\r\n        return this.store.insert(contract);\r\n    };\r\n\r\n    async update(props, task) {\r\n        console.log(props, task);\r\n        return this.store.update(props, task);\r\n    }\r\n\r\n    async remove(props) {\r\n        return this.store.remove(props);\r\n    }\r\n}\r\n\r\nexport default new ContractStore({ filename: './db/contracts.json', autoload: true });","import Koa from 'koa';\r\nimport WebSocket from 'ws';\r\nimport http from 'http';\r\nimport Router from 'koa-router';\r\nimport bodyParser from \"koa-bodyparser\";\r\nimport {timingLogger, exceptionHandler, jwtConfig, initWss, verifyClient} from './utils';\r\nimport {router as taskRouter} from './contract';\r\nimport {router as authRouter} from './auth';\r\nimport jwt from 'koa-jwt';\r\nimport cors from '@koa/cors';\r\n\r\nconst app = new Koa();\r\nconst server = http.createServer(app.callback());\r\nconst wss = new WebSocket.Server({ server });\r\ninitWss(wss);\r\n\r\napp.use(cors());\r\napp.use(timingLogger);\r\napp.use(exceptionHandler);\r\napp.use(bodyParser());\r\n\r\nconst prefix = '/api';\r\n\r\nconst publicApiRouter = new Router({ prefix });\r\npublicApiRouter.use('/auth', authRouter.routes());\r\napp.use(publicApiRouter.routes())\r\n    .use(publicApiRouter.allowedMethods());\r\n\r\napp.use(jwt(jwtConfig));\r\n\r\nconst protectedApiRouter = new Router({ prefix });\r\nprotectedApiRouter.use('/item', taskRouter.routes());\r\napp.use(protectedApiRouter.routes())\r\n    .use(protectedApiRouter.allowedMethods());\r\n\r\nserver.listen(8080);\r\nconsole.log('Server started on port 8080');","export const jwtConfig = { secret: 'my-secret' };\r\n","export * from './constants';\r\nexport * from './middlewares';\r\nexport * from './wss';\r\n","export const exceptionHandler = async (ctx, next) => {\r\n  try {\r\n    return await next();\r\n  } catch (err) {\r\n    ctx.body = { message: err.message || 'Unexpected error.' };\r\n    ctx.status = err.status || 500;\r\n  }\r\n};\r\n\r\nexport const timingLogger = async (ctx, next) => {\r\n  const start = Date.now();\r\n  await next();\r\n  console.log(`${ctx.method} ${ctx.url} => ${ctx.response.status}, ${Date.now() - start}ms`);\r\n};\r\n","import WebSocket from \"ws\";\r\nimport jwt from \"jsonwebtoken\";\r\nimport { jwtConfig } from \"./constants\";\r\n\r\nlet wss;\r\n\r\nexport const initWss = value => {\r\n  wss = value;\r\n  wss.on('connection', ws => {\r\n    ws.on('message', message => {\r\n      const { type, payload: { token } } = JSON.parse(message);\r\n      if (type !== 'authorization') {\r\n        ws.close();\r\n        return;\r\n      }\r\n      try {\r\n        ws.user = jwt.verify(token, jwtConfig.secret);\r\n      } catch (err) {\r\n        ws.close();\r\n      }\r\n    })\r\n  });\r\n};\r\n\r\nexport const broadcast = (userId, data) => {\r\n  if (!wss) {\r\n    return;\r\n  }\r\n  wss.clients.forEach(client => {\r\n    if (client.readyState === WebSocket.OPEN && userId === client.user._id) {\r\n      console.log(`broadcast sent to ${client.user.username}`);\r\n      client.send(JSON.stringify(data));\r\n    }\r\n  });\r\n};\r\n","module.exports = require(\"@koa/cors\");","module.exports = require(\"http\");","module.exports = require(\"jsonwebtoken\");","module.exports = require(\"koa\");","module.exports = require(\"koa-bodyparser\");","module.exports = require(\"koa-jwt\");","module.exports = require(\"koa-router\");","module.exports = require(\"nedb-promise\");","module.exports = require(\"ws\");"],"sourceRoot":""}